
@{
    ViewBag.Title = "Lập danh sách các môn phân đợt thi";
}
<h2>@ViewBag.Title</h2>
<table id="table">
    <thead>
        <tr>
            <th>MSMH</th>
            <th>Tên Môn Học</th>
            <th>Bộ Môn</th>
            <th>Khoa</th>
            <th>Nhóm</th>
            <th>SL SV</th>
            <th>Đợt</th>
           @* <th></th>*@
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
    <p></p>
    <br />
    <button id="SummitButton" type="button">Lưu</button>

@Html.Partial("_DataTable.Lib")

<script src="@Url.Content("~/Scripts/UI/jquery.mousewheel.js")" type="text/javascript" lang="javascript" ></script>
<script type="text/javascript" charset="utf-8">
    var oTable;
    oTable = $('#table').dataTable({
        "bServerSide": true,
        "sAjaxSource": "/Services/DataTable_SelectGroups",
        "bProcessing": true,
        "bFilter": false,
        "fnServerData": function (sSource, aoData, fnCallback) {
            $.ajax( {
                "dataType": 'json', 
                "type": "POST", 
                "url": sSource, 
                "data": aoData, 
                "success": fnCallback
            } );
        },
	    "aoColumnDefs": [
            {
                "bSortable": false, "aTargets": [0],
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                    var b = $('<span id="SubjectID">' + sData + '</span>');
                    $(nTd).empty();
                    $(nTd).prepend(b);
                }
            },
            {
                "bSortable": true, "aTargets": [1]
            },
            {
                "bSortable": false, "aTargets": [2]
            },
                
            {
                "bSortable": false, "aTargets": [3]
            },
            {
                "bSortable": false, "aTargets": [4],
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                    var b = $('<span id="Class">' + sData + '</span>');
                    $(nTd).empty();
                    $(nTd).prepend(b);
                }
            },
            {
                "bSortable": false, "aTargets": [5]
            },
            {
                "bSortable": false, "aTargets": [6],
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                    var b = $('<input type="text" id ="Group" size=2 readonly="true" value="' + sData + '" />');
                    b.spinner({
                        step: 1,
                        spin: function (event, ui) {
                            if (ui.value > 10) {
                                $(this).spinner("value", 1);
                                return false;
                            } else if (ui.value < 1) {
                                $(this).spinner("value", 10);
                                return false;
                            }
                        }
                    });
                    $(nTd).empty();
                    $(nTd).prepend(b.parent()).attr('align', 'center');
                }
            },
            //{
            //    "bSortable": false, "aTargets": [7],
            //    "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
            //        var b = $('<button>' + sData + '</button>');
            //        b.button({
            //            icons: {
            //                primary: "ui-icon-trash" // hình cái thùng rác
            //            }
            //        }).click(function (e) {
            //            e.preventDefault();
            //            var row = $(this).parent().parent(); // this là cái nút, cha của nó là td ông của nó là tr ==> cái hàng cần xoá
            //            if (row.length !== 0) {
            //                oTable.fnDeleteRow(row[0]);
            //            }
            //        });
            //        $(nTd).empty();
            //        $(nTd).prepend(b).attr('align', 'center');
            //    }
            //},
	    ], // không hiện nút sắp xếp!
        
	    @Html.Partial("_DataTable")
    });

    oTable.fnSettings().aoServerParams.push({
        "sName": "user",
        "fn": function (aoData) {
                oTable.$("#SubjectID").each(function (index, item) {
                    aoData.push({
                        "name": "SubjectID",
                        "value": $(this).text()
                    });
                });
                oTable.$("#Class").each(function (index, item) {
                    aoData.push({
                        "name": "Class",
                        "value": $(this).text()
                    });
                });
                oTable.$("#Group").each(function (index, item) {
                    aoData.push({
                        "name": "Group",
                        "value": $(this).spinner("value")
                    });
                });
                
        }
    });

	$('#SummitButton').button().click(function () {
	    var sData = "";
	    oTable.$("#SubjectID").each(function (index, item) {
	        sData = sData + (sData == '' ? '' : '&') + 'SubjectID=' + $(this).text();
	    });
	    oTable.$("#Class").each(function (index, item) {
	        sData = sData + '&Class=' + $(this).text();
	    });
	    oTable.$("#Group").each(function (index, item) {
	        sData = sData + '&Group=' + $(this).spinner("value");
	    });
	    $.post("/SelectGroup/SelectSuccess", sData);
	    alert("Đã lưu xong");
	    return false; 
	});
</script>